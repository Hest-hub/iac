---
- name: "Ensure iTerm2 is installed using Homebrew Cask"
  community.general.homebrew_cask:
    name: zsh
    state: present
  register: zsh_installed
  until: zsh_installed is succeeded
  tags:
    - macterm
    - macterm_iterm2

- name: "[install] Clone oh-my-zsh repo"
  git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: "{{ omz_home }}"
    version: master
    update: true
  become: true
  tags: omz

- name: "[install]: Clone zsh-autosuggestions plugin"
  git:
    repo: https://github.com/zsh-users/zsh-autosuggestions
    dest: "{{ omz_home }}/custom/plugins/zsh-autosuggestions"
    version: master
    update: yes
  become: true
  tags: omz

- name: "[install]: Clone zsh-history-substring-search plugin"
  git:
    repo: https://github.com/zsh-users/zsh-history-substring-search
    dest: "{{ omz_home }}/custom/plugins/zsh-history-substring-search"
    version: master
    update: yes
  become: true
  tags: omz

- name: "[install]: Clone zsh-syntax-highlighting plugin"
  git:
    repo: https://github.com/zsh-users/zsh-syntax-highlighting.git
    dest: "{{ omz_home }}/custom/plugins/zsh-syntax-highlighting"
    version: master
    update: yes
  become: true
  tags: omz

# Post setup
- name: "Set zsh as default shell"
  user: name={{ ansible_user_id }} shell=/bin/zsh
  become: true
  tags: omz
